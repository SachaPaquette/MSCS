<UserControl x:Class="MSCS.Views.MyAnimeListTrackingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:MSCS.Views">

    <UserControl.Resources>
        <DataTemplate x:Key="MyAnimeListResultTemplate">
            <Grid Margin="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0"
                        Width="80"
                        Height="110"
                        Background="{DynamicResource SurfaceAlt}"
                        CornerRadius="4">
                    <Image Source="{Binding CoverImageUrl}"
                           Stretch="UniformToFill"
                           ClipToBounds="True"
                           SnapsToDevicePixels="True" />
                </Border>

                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Title}"
                               Foreground="{DynamicResource SidebarText}"
                               FontWeight="SemiBold" />
                    <TextBlock Text="{Binding Synopsis}"
                               Foreground="{DynamicResource FgMuted}"
                               FontSize="12"
                               TextWrapping="Wrap"
                               MaxHeight="48"
                               TextTrimming="CharacterEllipsis" />

                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                        <TextBlock Text="Chapters:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                        <TextBlock Text="{Binding Chapters}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                        <TextBlock Text="•" Foreground="{DynamicResource FgSubtle}" FontSize="12" Margin="8,0" />
                        <TextBlock Text="Score:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                        <TextBlock Text="{Binding Score, StringFormat={}{0:0.#}}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="MyAnimeListSelectedTemplate">
            <Grid Margin="0,8,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="12" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0"
                        Width="120"
                        Height="165"
                        Background="{DynamicResource SurfaceAlt}"
                        CornerRadius="6">
                    <Image Source="{Binding CoverImageUrl}"
                           Stretch="UniformToFill"
                           ClipToBounds="True"
                           SnapsToDevicePixels="True" />
                </Border>

                <StackPanel Grid.Column="2">
                    <TextBlock Text="{Binding Title}"
                               Foreground="{DynamicResource FgMuted}"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap" />

                    <TextBlock Text="{Binding Synopsis}"
                               Foreground="{DynamicResource FgSubtle}"
                               FontSize="12"
                               TextWrapping="Wrap"
                               Margin="0,6,0,0" />

                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">

                        <StackPanel Orientation="Horizontal" Margin="0,0,12,0">
                            <TextBlock Text="Chapters:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                            <TextBlock Text="{Binding Chapters}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Score:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                            <TextBlock Text="{Binding Score, StringFormat={}{0:0.#}}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                        </StackPanel>

                    </StackPanel>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="MyAnimeListUpdateTemplate">
            <StackPanel>
                <ComboBox ItemsSource="{Binding StatusOptions}"
                          SelectedValuePath="Value"
                          DisplayMemberPath="Display"
                          SelectedValue="{Binding SelectedStatus, Mode=TwoWay}"
                          Height="32"
                          Background="{DynamicResource SurfaceAlt}"
                          Foreground="{DynamicResource SidebarText}"
                          BorderBrush="{DynamicResource SurfaceBorder}" />

                <StackPanel Orientation="Horizontal" Margin="0,12,0,0" VerticalAlignment="Center">
                    <CheckBox Content="Set progress"
                              IsChecked="{Binding UseProgress}"
                              Foreground="{DynamicResource SidebarText}"
                              Margin="0,0,8,0" />
                    <TextBox Text="{Binding ProgressText, UpdateSourceTrigger=PropertyChanged}"
                             Width="80"
                             Height="28"
                             IsEnabled="{Binding UseProgress}"
                             Background="{DynamicResource SurfaceAlt}"
                             Foreground="{DynamicResource SidebarText}"
                             BorderBrush="{DynamicResource SurfaceBorder}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,10,0,0" VerticalAlignment="Center">
                    <CheckBox Content="Set score"
                              IsChecked="{Binding UseScore}"
                              Foreground="{DynamicResource SidebarText}"
                              Margin="0,0,8,0" />
                    <Slider Minimum="0"
                            Maximum="10"
                            Width="180"
                            Value="{Binding Score, Mode=TwoWay}"
                            IsEnabled="{Binding UseScore}"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True" />
                    <TextBlock Text="{Binding ScoreDisplay}"
                               Foreground="{DynamicResource FgMuted}"
                               Margin="8,0,0,0" />
                </StackPanel>

            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <views:TrackingDialogBase Title="MyAnimeList Tracking"
                               SearchQuery="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                               SearchCommand="{Binding SearchCommand}"
                               Results="{Binding Results}"
                               SelectedItem="{Binding SelectedMedia, Mode=TwoWay}"
                               ResultItemTemplate="{StaticResource MyAnimeListResultTemplate}"
                               SelectedContentTemplate="{StaticResource MyAnimeListSelectedTemplate}"
                               UpdateContentTemplate="{StaticResource MyAnimeListUpdateTemplate}"
                               ExistingEntrySummary="{Binding ExistingEntrySummary}"
                               UpdateHeader="Update MyAnimeList entry"
                               StatusMessage="{Binding StatusMessage}"
                               ConfirmCommand="{Binding ConfirmCommand}"
                               CancelCommand="{Binding CancelCommand}" />

</UserControl>