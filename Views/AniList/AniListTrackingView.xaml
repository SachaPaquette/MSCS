<UserControl x:Class="MSCS.Views.AniListTrackingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:MSCS.Views">
    <UserControl.Resources>
        <DataTemplate x:Key="AniListResultTemplate">
            <Grid Margin="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="80" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border Grid.Column="0"
                        Width="80"
                        Height="110"
                        Background="{DynamicResource SurfaceAlt}"
                        CornerRadius="4">
                    <Image Source="{Binding CoverImageUrl}"
                           Stretch="UniformToFill"
                           ClipToBounds="True"
                           SnapsToDevicePixels="True" />
                </Border>
                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                    <TextBlock Text="{Binding DisplayTitle}"
                               Foreground="{DynamicResource SidebarText}"
                               FontWeight="SemiBold" />
                    <TextBlock Text="{Binding NativeTitle}"
                               Foreground="{DynamicResource FgMuted}"
                               FontSize="12"
                               TextTrimming="CharacterEllipsis" />
                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                        <TextBlock Text="Status:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                        <TextBlock Text="{Binding Status}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                    </StackPanel>
                    <TextBlock Text="{Binding StartDateText, StringFormat=Started {0}}"
                               Foreground="{DynamicResource FgMuted}"
                               FontSize="12" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="AniListSelectedTemplate">
            <StackPanel>
                <TextBlock Text="{Binding DisplayTitle}"
                           Foreground="{DynamicResource FgMuted}"
                           Margin="0,2,0,4"
                           TextWrapping="Wrap" />
                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                    <StackPanel Orientation="Horizontal" Margin="0,0,12,0">
                        <TextBlock Text="Format:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                        <TextBlock Text="{Binding FormatDisplay}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,12,0">
                        <TextBlock Text="Chapters:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                        <TextBlock Text="{Binding Chapters}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Score:" Foreground="{DynamicResource FgSubtle}" FontSize="12" />
                        <TextBlock Text="{Binding MeanScoreDisplay}" Foreground="{DynamicResource FgMuted}" FontSize="12" Margin="4,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="AniListUpdateTemplate">
            <StackPanel>
                <ComboBox ItemsSource="{Binding StatusOptions}"
                          SelectedValuePath="Value"
                          DisplayMemberPath="Display"
                          SelectedValue="{Binding SelectedStatus, Mode=TwoWay}"
                          Height="32"
                          Background="{DynamicResource SurfaceAlt}"
                          Foreground="{DynamicResource SidebarText}"
                          BorderBrush="{DynamicResource SurfaceBorder}" />

                <CheckBox Content="Update progress to current chapter"
                          Margin="0,10,0,0"
                          IsChecked="{Binding ApplySuggestedProgress}"
                          IsEnabled="{Binding CanApplySuggestedProgress}"
                          Foreground="{DynamicResource SidebarText}"
                          ToolTip="Use the reader's current chapter as your AniList progress" />

                <StackPanel Orientation="Horizontal" Margin="0,10,0,0" VerticalAlignment="Center">
                    <CheckBox Content="Update score"
                              IsChecked="{Binding UseScore}"
                              Foreground="{DynamicResource SidebarText}"
                              Margin="0,0,8,0" />
                    <Slider Minimum="0"
                            Maximum="100"
                            Width="180"
                            Value="{Binding Score, Mode=TwoWay}"
                            IsEnabled="{Binding UseScore}"
                            TickFrequency="5"
                            IsSnapToTickEnabled="True" />
                    <TextBlock Text="{Binding ScoreDisplay}"
                               Foreground="{DynamicResource FgMuted}"
                               Margin="8,0,0,0" />
                </StackPanel>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <views:TrackingDialogBase Title="Add Tracking"
                               SearchQuery="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                               SearchCommand="{Binding SearchCommand}"
                               Results="{Binding Results}"
                               SelectedItem="{Binding SelectedMedia, Mode=TwoWay}"
                               ResultItemTemplate="{StaticResource AniListResultTemplate}"
                               SelectedContentTemplate="{StaticResource AniListSelectedTemplate}"
                               UpdateContentTemplate="{StaticResource AniListUpdateTemplate}"
                               ExistingEntrySummary="{Binding ExistingEntrySummary}"
                               UpdateHeader="Update AniList entry"
                               StatusMessage="{Binding StatusMessage}"
                               ConfirmCommand="{Binding ConfirmCommand}"
                               CancelCommand="{Binding CancelCommand}" />
</UserControl>